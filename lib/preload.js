const xhrProxy = require('./xhr_proxy.js');const {ipcRenderer, contextBridge} = require('electron');let staticInfo = null;xhrProxy.addHandler(function (xhr) {    // console.log(xhr.responseURL)    if (xhr.responseURL.indexOf('https://zb.lnwsjktj.com:8080/webPage/ei/webreportservice.do') >= 0) {        console.log(xhr)        // ipcRenderer.send("sendMessage", xhr.responseURL, xhr.response)    }    if (xhr.responseURL.indexOf('/seat.gz') >= 0) {        // // const response = decodeData(xhr.response);        // const response = decodeData(xhr.response,        //   staticInfo.seatQuYu.seatStaticHash,        //   'gz',        //   'pb');        // // alert(JSON.stringify(response.data))        // ipcRenderer.send("sendMessage", JSON.stringify(response.data),'gz')        // // ipcRenderer.send("sendMessage", xhr.responseURL, xhr.response)    }});/** * 重写fetch获取请求 * @type {(input: RequestInfo, init?: RequestInit) => Promise<Response>} */const fetch = window.fetch;let projectComboBox = null;let areaInfoParams = null;let types = null;window.fetch = (url, config) => {    return new Promise(async (resolve, reject) => {        fetch(url, config).then((response) => {            response.clone().json().then(result => {                if (url.indexOf('/pms/project/getProjectComboBox') >= 0) {                    projectComboBox = result.data;                }                if (url.indexOf('/basic/lock/operate/listTicketCloudLockTypeByUserAndPtnr') >= 0) {                    types = result.data;                }                if (url.indexOf('/pms/ticket/lock/queryAreaInfo') >= 0) {                    console.log(config.params);                    areaInfoParams = config.params;                    staticInfo = JSON.parse(result.data);                }                if (url.indexOf('/pms/ticket/lock/querySeatStatus') >= 0) {                    // console.log(qs.stringify(config.data));                    // ipcRenderer.send("sendMessage",  'http://pms.maitix.com/?'+qs.stringify(config.data))                    let siteVersionId = 0;                    for (let i = 0; i < projectComboBox.length; i++) {                        const item = projectComboBox[i];                        console.log(item)                        if (config.data.projectId === item.projectId && item.eventComboBoxVOList) {                            for (let j = 0; j < item.eventComboBoxVOList.length; j++) {                                const tmp = item.eventComboBoxVOList[j]                                if (tmp.eventId === config.data.performanceId) {                                    siteVersionId = tmp.siteVersionId                                }                            }                        }                    }                    let itemId = 0;                    for (let i = 0; i < types.length; i++) {                        const item = types[i];                        if (item.itemValue === '赠票') {                            itemId = item.itemId                        }                    }                    const {quyu} = staticInfo.seatQuYu;                    console.log(staticInfo)                    let tmpQuyu = [];                    if (quyu) {                        tmpQuyu = quyu.map(item => {                            return {                                vid: item.vid,                                n: item.n                            }                        });                    }                    ipcRenderer.send("sendMessage", 'http://pms.maitix.com/?param=' + encodeURIComponent(JSON.stringify(config.data)) + '&lockType=' + itemId + '&siteVersionId=' + siteVersionId + '&stands=' + encodeURIComponent(JSON.stringify(tmpQuyu)), 'url')                    // staticInfo = JSON.parse(areaInfo.data);                }            })            resolve(response);        }).catch((err) => {            reject(err)        })    })}ipcRenderer.on('post', (event, args) => {    console.log('setData==>', args)    // 获取数据之后保存数据    // https://zb.lnwsjktj.com:8080/webPage/ei/webreportservice.do    // taskid: {B5C8ACF5-B0C7-423A-95DF-09D2B31A7766}.d89608b106fb3b82441e2dc0b17dfcde    // ds: main    // bbq: 202302--    // curbtype: 9    // upid: 210000002618    // curbbh: 210000002618    // __t__    // rpt    // bbh    // btype    // customparams})try {    contextBridge.exposeInMainWorld('electronAPI', {        getData: (data) => ipcRenderer.invoke('getData', data)    })} catch (e) {}console.log('注入preloadJS了')